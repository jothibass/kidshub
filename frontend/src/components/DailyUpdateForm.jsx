import React,{useState}from'react';import * as api from'../api/kidshub';
export default function DailyUpdateForm({childId,onCreated}){const[body,setBody]=useState('');const[photo,setPhoto]=useState(null);const[saving,setSaving]=useState(false);
async function uploadPhotoAndGetId(){if(!photo)return null;const pres=await api.presign(childId,photo.name,photo.type,photo.size);await fetch(pres.uploadUrl,{method:'PUT',headers:{'Content-Type':photo.type},body:photo});const meta=await api.postMediaMeta(childId,{s3_key:pres.key,mime_type:photo.type,size_bytes:photo.size,caption:''});return meta.id;}
async function save(){if(!body.trim())return alert('Write at least one sentence');setSaving(true);try{const photoId=await uploadPhotoAndGetId();const r=await api.postDailyUpdate(childId,{body,photo_media_id:photoId});onCreated&&onCreated(r);setBody('');setPhoto(null);}catch(e){alert('Save failed: '+e.message)}finally{setSaving(false)}} 
return(<div className="card"><h3>Daily Update</h3><div className="form-row"><textarea placeholder="Write something about today"value={body}onChange={e=>setBody(e.target.value)}/></div><div className="form-row"><input type="file"accept="image/*"onChange={e=>setPhoto(e.target.files[0])}/></div><div style={{display:'flex',justifyContent:'flex-end',gap:8}}><button className="btn secondary"onClick={()=>{setBody('');setPhoto(null);}}>Clear</button><button className="btn"onClick={save}disabled={saving}>{saving?'Publishing...':'Publish Update'}</button></div></div>);}
